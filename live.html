<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Live Results - Referee Panel | Robo-Football</title>
  <link rel="stylesheet" href="style.css" />
  
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.3.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.3.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.3.0/firebase-firestore-compat.js"></script>
  
  <script src="firebase-config.js"></script>

  <script>
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const loginForm = () => document.getElementById('login-form');
    const panel = () => document.getElementById('match-editor');
    const userInfo = () => document.getElementById('user-info');
    const teamAInput = () => document.getElementById('teamA');
    const teamBInput = () => document.getElementById('teamB');
    const scoreAInput = () => document.getElementById('scoreA');
    const scoreBInput = () => document.getElementById('scoreB');
    const liveResultsContainer = () => document.getElementById('live-results');

    function showLogin() {
      loginForm().style.display = 'block';
      panel().style.display = 'none';
      userInfo().textContent = '';
    }

    function showPanel(user) {
      loginForm().style.display = 'none';
      panel().style.display = 'block';
      userInfo().innerHTML = `Logged in as: ${user.email} <button onclick="logout()">Logout</button>`;
      loadLiveResults();
    }

    function login() {
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value.trim();
      auth.signInWithEmailAndPassword(email, password)
        .catch(err => alert('Login failed: ' + err.message));
    }

    function logout() {
      auth.signOut();
    }

    function saveResult() {
      const teamA = teamAInput().value.trim();
      const teamB = teamBInput().value.trim();
      const scoreA = parseInt(scoreAInput().value);
      const scoreB = parseInt(scoreBInput().value);

      if (!teamA || !teamB) {
        alert('Please enter both team names.');
        return;
      }
      if (teamA.toLowerCase() === teamB.toLowerCase()) {
        alert('Teams must be different.');
        return;
      }
      if (isNaN(scoreA) || scoreA < 0 || isNaN(scoreB) || scoreB < 0) {
        alert('Please enter valid non-negative scores.');
        return;
      }

      // Add new live result
      db.collection('liveResults').add({
        teamA,
        teamB,
        scoreA,
        scoreB,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      }).then(() => {
        alert('Live result saved!');
        teamAInput().value = '';
        teamBInput().value = '';
        scoreAInput().value = '';
        scoreBInput().value = '';
      }).catch(err => alert('Error saving result: ' + err.message));
    }

    function loadLiveResults() {
      liveResultsContainer().innerHTML = 'Loading live results...';
      db.collection('liveResults')
        .orderBy('timestamp', 'desc')
        .limit(20)
        .onSnapshot(snapshot => {
          if (snapshot.empty) {
            liveResultsContainer().innerHTML = '<p>No live results yet.</p>';
            return;
          }
          let html = '<table><thead><tr><th>Team A</th><th>Score</th><th>Team B</th><th>Score</th><th>Time</th><th>Action</th></tr></thead><tbody>';
          snapshot.forEach(doc => {
            const d = doc.data();
            const timeStr = d.timestamp ? new Date(d.timestamp.seconds * 1000).toLocaleString() : '...';
            html += `
              <tr>
                <td>${d.teamA}</td>
                <td>${d.scoreA}</td>
                <td>${d.teamB}</td>
                <td>${d.scoreB}</td>
                <td>${timeStr}</td>
                <td><button onclick="deleteResult('${doc.id}')">Delete</button></td>
              </tr>`;
          });
          html += '</tbody></table>';
          liveResultsContainer().innerHTML = html;
        });
    }

    function deleteResult(docId) {
      if (confirm('Are you sure you want to delete this result?')) {
        db.collection('liveResults').doc(docId).delete()
          .then(() => alert('Deleted successfully!'))
          .catch(err => alert('Delete failed: ' + err.message));
      }
    }

    auth.onAuthStateChanged(user => {
      if (user) showPanel(user);
      else showLogin();
    });
  </script>
</head>
<body>
  <header>
    <h1>ðŸ¤– Robo-Football</h1>
    <nav>
      <a href="fixtures.html">Fixtures</a>
      <a href="teams.html">Teams</a>
      <a href="results.html">Results</a>
      <a href="live.html">Live Results</a>
    </nav>
  </header>

  <main>
    <h2>Live Results - Referee Panel</h2>

    <div id="user-info" style="margin-bottom:20px;"></div>

    <div id="login-form" style="max-width:300px;">
      <input id="email" type="email" placeholder="Email" style="width:100%; padding:8px; margin-bottom:10px;" />
      <input id="password" type="password" placeholder="Password" style="width:100%; padding:8px; margin-bottom:10px;" />
      <button onclick="login()" style="width:100%; padding:10px;">Log In</button>
    </div>

    <div id="match-editor" style="display:none; max-width:600px;">
      <label for="teamA">Team A Name:</label>
      <input type="text" id="teamA" style="width:100%; padding:8px; margin-bottom:10px;" />

      <label for="scoreA">Team A Score:</label>
      <input type="number" id="scoreA" min="0" style="width:100%; padding:8px; margin-bottom:10px;" />

      <label for="teamB">Team B Name:</label>
      <input type="text" id="teamB" style="width:100%; padding:8px; margin-bottom:10px;" />

      <label for="scoreB">Team B Score:</label>
      <input type="number" id="scoreB" min="0" style="width:100%; padding:8px; margin-bottom:10px;" />

      <button onclick="saveResult()" style="width:100%; padding:10px; margin-bottom:20px;">Save Live Result</button>

      <h3>Current Live Results</h3>
      <div id="live-results"></div>
    </div>
  </main>
</body>
</html>
